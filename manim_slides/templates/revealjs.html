<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>{{ title }}</title>

    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/{{ reveal_version }}/reveal.min.css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/{{ reveal_version }}/theme/{{ reveal_theme }}.min.css">

    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/zenburn.min.css">
  </head>

  <body>
    <div class="reveal">
      <div class="slides">

        {# ============================================================
           CHANGE #1: Iterate over SLIDE GROUPS instead of flat slides
           ------------------------------------------------------------
           - Each `slide_group` represents ONE HORIZONTAL slide
           - Each slide inside the group is a VERTICAL slide
           ============================================================ #}

        {% for presentation_config in presentation_configs -%}
          {%- set outer_loop = loop %}

          {% for slide_group in presentation_config.slide_groups %}
            <!-- Horizontal slide -->
            <section>

              {# ======================================================
                 CHANGE #2: Inner loop renders VERTICAL slides
                 ====================================================== #}

              {% for slide_config in slide_group %}

                {# Existing logic: resolve video file path #}
                {% if one_file %}
                  {% set file = file_to_data_uri(slide_config.file) %}
                {% else %}
                  {% set file = assets_dir / (prefix(outer_loop.index0) + slide_config.file.name) %}
                {% endif %}

                <!-- Vertical slide -->
                <section
                  data-background-size={{ background_size }}
                  data-background-color="{{ presentation_config.background_color }}"
                  data-background-video="{{ file }}"

                  {# Mute first slide only (existing behavior preserved) #}
                  {% if loop.index == 1 and outer_loop.index == 1 %}
                  data-background-video-muted
                  {% endif %}

                  {% if slide_config.loop %}
                  data-background-video-loop
                  {% endif %}

                  {% if slide_config.auto_next %}
                  data-autoslide="{{ get_duration_ms(slide_config.file) }}"
                  {% endif %}
                >

                  {# Speaker notes (unchanged) #}
                  {% if slide_config.notes != "" %}
                    <aside class="notes" data-markdown>
                      {{ slide_config.notes }}
                    </aside>
                  {% endif %}

                </section>
              {% endfor %}

            </section>
          {% endfor %}
        {% endfor %}

      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/{{ reveal_version }}/reveal.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/{{ reveal_version }}/plugin/notes/notes.min.js"></script>

    {% if has_notes %}
      <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/{{ reveal_version }}/plugin/markdown/markdown.min.js"></script>
    {% endif %}

    <script>
      Reveal.initialize({
        {% if has_notes %}
        plugins: [ RevealMarkdown, RevealNotes ],
        {% endif %}
        width: {{ width }},
        height: {{ height }},
        margin: {{ margin }},
        minScale: {{ min_scale }},
        maxScale: {{ max_scale }},
        controls: {{ controls }},
        controlsTutorial: {{ controls_tutorial }},
        progress: {{ progress }},
        slideNumber: {{ slide_number }},
        showSlideNumber: {{ show_slide_number }},
        hash: {{ hash }},
        keyboard: {{ keyboard }},
        loop: {{ loop }},
        center: {{ center }},
        transition: {{ transition }},
        transitionSpeed: {{ transition_speed }}
      });
    </script>

  </body>
</html>
